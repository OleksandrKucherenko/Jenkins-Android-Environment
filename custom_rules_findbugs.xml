<?xml version="1.0" encoding="UTF-8"?>
<project name="{project-name}" default="help">
  <echo>Custom Rules: Findbugs Tool</echo>
  <echo>-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</echo>
  <echo>Available Targets:</echo>
  <echo>  findbugs:</echo>
  <echo>    Execute findbugs tool on project.</echo>
  <echo>-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</echo>

  <!-- quick check on sdk.dir & tools.dir -->
  <fail message="sdk.dir is missing." unless="sdk.dir" />
  <fail message="tools.dir is missing." unless="tools.dir" />

  <!-- FindBugs Tool properties -->
  <property name="findbugs.home" value="${tools.dir}/findbugs-2.0.3" />
  
  <path id="tools.findbugs.antlibs">
    <pathelement path="${findbugs.home}/lib/findbugs-ant.jar" />
  </path>
  
  <taskdef name="findbugs"
           classname="edu.umd.cs.findbugs.anttask.FindBugsTask"
           classpathref="tools.findbugs.antlibs" />
 
  <!-- 
  ================================= 
    target: findbugs              
  =================================
  -->
  
  <target name="findbugs" description="Execute FindBugs tools for project code.">
    <echo>Resolving Build Target for ${ant.project.name}...</echo>
    <!-- load project properties, resolve Android target, library dependencies
	  and set some properties with the results.
	  All property names are passed as parameters ending in -Out -->
    <gettarget
	    androidJarFileOut="project.target.android.jar"
	    androidAidlFileOut="project.target.framework.aidl"
	    bootClassPathOut="project.target.class.path"
	    targetApiOut="project.target.apilevel"
	    minSdkVersionOut="project.minSdkVersion" />
    
    <echo>Resolving Dependencies for ${ant.project.name}...</echo>
    <dependency
	    libraryFolderPathOut="project.library.folder.path"
	    libraryPackagesOut="project.library.packages"
	    libraryManifestFilePathOut="project.library.manifest.file.path"
	    libraryResFolderPathOut="project.library.res.folder.path"
	    libraryBinAidlFolderPathOut="project.library.bin.aidl.folder.path"
	    libraryRFilePathOut="project.library.bin.r.file.path"
	    libraryNativeFolderPathOut="project.library.native.folder.path"
	    jarLibraryPathOut="project.all.jars.path"
	    targetApi="${project.target.apilevel}"
	    renderscriptSupportMode="${renderscript.support.mode}"
	    buildToolsFolder="${android.build.tools.dir}"
	    renderscriptSupportLibsOut="project.rs.support.libs.path"
	    verbose="${verbose}" />    
    
    <path id="jar.libs.ref">
      <fileset dir="${jar.libs.absolute.dir}" includes="*.jar" />
    </path>
                    
    <mkdir dir="findbugs" />
    
    <findbugs home="${findbugs.home}"
              output="xml"
              outputFile="findbugs/findbugs.xml"
              excludeFilter="${findbugs.home}/android_excludes.xml">
      <auxClasspath>
        <path refid="jar.libs.ref" />
        <!-- prev sdk tools use: android.target.classpath -->
        <path refid="project.target.class.path" />
      </auxClasspath>
      <sourcePath path="${source.absolute.dir}" />
      <class location="${out.classes.absolute.dir}" />
    </findbugs>
  </target>

</project>