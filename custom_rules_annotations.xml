<?xml version="1.0" encoding="UTF-8"?>
<project name="{project-name}" default="help">
  <echo>Custom Rules: Android Annotations</echo>  
  <echo>-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</echo>
  <echo>Available Targets:</echo>
  <echo>  annotations:</echo>
  <echo>    Execute Android Annotations Build logic for project.</echo>
  <echo>-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</echo>

  <!-- quick check on sdk.dir & tools.dir -->
  <fail message="sdk.dir is missing." unless="sdk.dir" />
  <fail message="tools.dir is missing." unless="tools.dir" />

  <!-- annotation variables -->
  <property name="annotations.jar" value="androidannotations-3.0.jar" />
  <property name="annotations.jar.dir" value="compile-libs"/>
  <property name="annotations.jar.absolute.dir" location="${annotations.jar.dir}" />
  <property name="annotations.jar.absolute.path" value="${annotations.jar.absolute.dir}/${annotations.jar}" />
  <property name="annotations.processor" value="org.androidannotations.AndroidAnnotationProcessor" />
  
  <!-- 
    References:
    https://github.com/excilys/androidannotations/wiki/Automating-the-Build-in-Jenkins-with-Ant
  -->
  
  <target name="annotations">
      
    <echo>-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</echo>
    <echo>      AndroidAnnotations is generating code       </echo>
    <echo>-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</echo>

    <echo>Resolving Build Target for ${ant.project.name}...</echo>
    <!-- load project properties, resolve Android target, library dependencies
	  and set some properties with the results.
	  All property names are passed as parameters ending in -Out -->
    <gettarget
      androidJarFileOut="project.target.android.jar"
	    androidAidlFileOut="project.target.framework.aidl"
	    bootClassPathOut="project.target.class.path"
	    targetApiOut="project.target.apilevel"
	    minSdkVersionOut="project.minSdkVersion" />
    
    <echo>Resolving Dependencies for ${ant.project.name}...</echo>
    <dependency
	    libraryFolderPathOut="project.library.folder.path"
	    libraryPackagesOut="project.library.packages"
	    libraryManifestFilePathOut="project.library.manifest.file.path"
	    libraryResFolderPathOut="project.library.res.folder.path"
	    libraryBinAidlFolderPathOut="project.library.bin.aidl.folder.path"
	    libraryRFilePathOut="project.library.bin.r.file.path"
	    libraryNativeFolderPathOut="project.library.native.folder.path"
	    jarLibraryPathOut="project.all.jars.path"
	    targetApi="${project.target.apilevel}"
	    renderscriptSupportMode="${renderscript.support.mode}"
	    buildToolsFolder="${android.build.tools.dir}"
	    renderscriptSupportLibsOut="project.rs.support.libs.path"
	    verbose="${verbose}" /> 
      
    <!-- Debugging helpers, uncomment to see more debug info -->
    <!--
    <echoproperties/>
    <echo>${toString:project.library.folder.path}</echo>
    <echo>${toString:project.all.jars.path}</echo>
    <echo>-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</echo>
    -->
    <javac  encoding="${java.encoding}"
            source="${java.source}" 
            target="${java.target}"
            debug="true" 
            extdirs="" 
            includeantruntime="false"
            destdir="${out.classes.absolute.dir}"
            bootclasspathref="project.target.class.path"
            verbose="${verbose}"
            classpath="${extensible.classpath}"
            classpathref="project.all.jars.path"
            fork="${need.javac.fork}">
      <src path="${source.absolute.dir}" />
      <src path="${gen.absolute.dir}" />
      <classpath>
        <fileset dir="libs" includes="*.jar" />
      </classpath>
      <compilerarg value="-proc:only" />
      <compilerarg value="-processorpath"/>
      <compilerarg value="${annotations.jar.absolute.path}"/>
      <compilerarg value="-processor" />
      <compilerarg value="${annotations.processor}" />
      <compilerarg value="-AandroidManifestFile=${manifest.abs.file}" />
      <compilerarg value="-AresourcePackageName=com.truecaller" />
      <compilerarg value="-s" />
      <compilerarg value="${gen.absolute.dir}" />
    </javac>
    
    <echo>-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</echo>
  </target>
    
 </project>